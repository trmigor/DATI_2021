# DATI_2021

Решение задач для собеседования на Кафедру теоретической и прикладной информатики МФТИ на базе Acronis.

## Структура репозитория

Файлы с решением каждой задачи находятся в директориях с соответствующим названием.

## Системные требования

Необходима операционная система семейства **Linux** или **OS X**. Также требуется **GNU C++** компилятор версии 10.3 и выше или **Apple clang** компилятор версии 12.0.0 и выше, а также утилита **GNU make** версии 3.81 и выше.

## Сборка

Для сборки всех задач исполните:

```
make
```

Все исполняемые файлы будут расположены в директории `bin` корневого каталога репозитория.

Для удаления файлов сборки и исполняемых файлов, исполните:

```
make clean
```

---

## CrackMe

### Условие задачи

> Вам дана программа [**crackme**](http://tiny.cc/s304nz) (измените расширение файла на .exe), которая ожидает от вас логин и пароль. Патчить программу нельзя. Напишите консольное или оконное/графическое решение, которая принимает на вход логин (проверяет валидный ли логин) и возвращает минимум один пароль, подходящие для **crackme**. Оцениваться будет не только решение, но и стиль кода, его архитектура.

### Структура каталога

Решение задачи находится в директории [crackme/](crackme). В директории [crackme/include/](crackme/include) находится заголовочный файл [keygen.hpp](crackme/include/keygen.hpp) с прототипами используемых функций. Их реализация, а также функция `main` находятся в директории [crackme/source/](crackme/source) в файлах [keygen.cpp](crackme/source/keygen.cpp) и [main.cpp](crackme/source/main.cpp) соответственно.

В директории [crackme/exe/](crackme/exe) находится файл [crackme.exe](crackme/exe/crackme.exe), который и требовалось исследовать.

В директории [crackme/IDA/](crackme/IDA) находятся файл [crackme.i64](crackme/IDA/crackme.i64), содержащий базу данных, сгенерированную [IDA Freeware](https://www.hex-rays.com/ida-free/) при дизассемблировании [crackme.exe](crackme/exe/crackme.exe).

### Сборка

Для сборки только этой задачи исполните:

```
make -C crackme
```

После этого исполняемый файл будет расположен в директории [crackme/bin/](crackme/bin).

### Решение

Для дизассемблирования и исследования задачи была использована программа [IDA Freeware](https://www.hex-rays.com/ida-free/). Были обнаружены строки, соответствующие сообщениям об успехе и неудаче при вводе логина и пароля, а также процедуры, которые ссылаются на них. С помощью графа вызовов было определено, что они вызываются из процедуры `WndProc`. При ее исследовании были также обнаружены процедуры, обрабатывающие логин и пароль, введенные в программу, а также операции, отвечающие за логику сверки логина и пароля.

Логин считается валидным, если содержит только символы, расположенные в таблице ASCII не ранее заглавной буквы ***A*** латинского алфавита. Кроме того, пустой логин не обрабатывается вообще, соответственно, будем считать его невалидным. Затем, в ходе обработки все символы, следующие после заглавной латинской буквы ***Y***, заменяются на те символы, что стоят в таблице ASCII ранее на 32 позиции (`0x20`). После, все символы суммируются по кодам и подвергаются операции исключающего ИЛИ с числом `0x5678`.

Обработка пароля заключается в следующем: из каждого символа вычитается символ нуля `'0'`, а затем полученная разность прибавляется к предыдущей сумме, умноженной на 10. Таким образом, полученная сумма представляет собой многочлен в точке 10 с коэффициентами, равными разностям символа пароля на соответствующей позиции и символа `'0'`. Затем эта сумма подвергается операции исключающего ИЛИ с числом `0x1234`.

Далее результаты обработки логина и пароля сравниваются, и при равенстве выдается сообщение об успехе.

Таким образом, наиболее простым вариантом пароля для определенного логина будет число, равное подобной сумме.

Решение состоит из функции `main` и трех вспомогательных функций: `isValid`, `generatePassword` и `process`.

Функция `isValid` проверяет, является ли логин валидным.

Функция `generatePassword` генерирует пароль по валидному логину. Она преобразует логин аналогично исходной программе, а затем полученное число подвергает операции исключающего ИЛИ с числом `0x1234`. Полученное число, переведенное в формат строки, и будет ответом.

Функция `process` вызывается из `main` и производит сначала проверку логина, а затем выводом ответа. В случае валидного логина, она возвращает EXIT_SUCCESS, иначе - выводит сообщение о неправильности логина и возвращает EXIT_FAILURE.

Функция `main` занимается считыванием входных данных. Она поддерживает передачу логина через аргументы командной строки, а также через стандартный ввод.
